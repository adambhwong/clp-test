Tools:  
  gitlab  


Concept:  
  Using gitlab kubernetes integration feature to connect the AWS EKS, and let the gitlab CI/CD pipeline to walkthrough the build & deploy with a single push/merge. Within gitlab auto-devops, code cliamte is embedded for code quality review. Additional helm chart code will be injected into the project source code to define the app deployment in kubernetes. As we are using EKS, the auto healing will be defined in the deployment definition.


Architecure:
  Using gitlab will give you a most simple architecture and workflow, as it has repo + CI/CD + K8s integration.

  developer --push-> gitlab --auto fire embedded CI/CD pipeline-> push image to ECR --helm chart deploy-> EKS

  EKS deployment objects:

  secret: user-api
  
  deployment: user-api

  service: user-api

  ingress: user-api

  *Assume using an isolated EKS network, all connections are expected to route through the Ingress controller, and HTTP connections are protected by SSL layer. That the final port exposed will be 80, 443 and foward all 80 connections to 443 with HTTPS protection.*


gitlab pipeline:
  .auto-deploy


Procedure:
  In gitlab, visit the project page > operations > kubernetes. Then add the EKS by following the steps. And in managed-apps tab, install ingress and cert manager to the EKS.

  Then you have to install the CA cert to the EKS clusterIssuer for the manager to work properly.

  Push code to the project repo and it should run the build -> code quality -> test -> deploy.  


Updates:  
  
 - testing embedded in auto-deploy step within the pipeline, you can find the screen short from user-api_deploy_test.png.  
 - user variables are configured in the pipeline as screen short file user-api_variables.png.  
 - pipline execution screen output is captured for reference in file user-api_pipeline.png.  
 - since I have no AWS resources for hosting this testing project, the deployment is acutally run in private kubernetes and deployed API is not open for public access.  
 - endpoint URL will be generated by gitlab base on project name and deployment environment as show in screen cap file user-api_deploy_ingress.png, private network information is masked.  
 - a final health check test with the ingress FQDN above is done with postman and captured in user-api_fqdn_test.png for reference, private network information is masked.  


Additional Note:  
  For AWS EKS to automate the FQDN mapping with deployed ingress, you have to install external-dns and using route53 module to implement a Dynamic DNS service for the entire cluster. Plus you have to provide the defined subdomain for the cluster in the gitlab kubernetes integration configuration.    
